rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ⚠️ NOTA: Sistema usa autenticación custom (Firestore + AsyncStorage)
    // NO utiliza Firebase Authentication. La validación de permisos se hace
    // a nivel de aplicación a través de roles de usuario.
    // Por eso Firestore rules es completamente abierto - confía en app-level validation
    
    // REGLA POR DEFECTO: Permitir todo
    match /{document=**} {
      allow read, write: if true;
    }
    
    // USUARIOS (más específico, pero permite todo igual)
    match /users/{userId} {
      allow read, write: if true;
    }
    
    // TAREAS (más específico, pero permite todo igual)
    match /tasks/{taskId} {
      allow read, write: if true;
      
      // SUBTAREAS - Nested under tasks (muy específico para asegurar que se permite)
      match /subtasks/{subtaskId} {
        allow read, write: if true;
      }
      
      // MENSAJES - Nested under tasks
      match /messages/{messageId} {
        allow read, write: if true;
      }
    }
    
    // FCM TOKENS
    match /fcmTokens/{tokenId} {
      allow read, write: if true;
    }
    
    // REPORTES
    match /reports/{reportId} {
      allow read, write: if true;
    }
    
    // FIRMAS
    match /signatures/{signatureId} {
      allow read, create: if true;
      allow update, delete: if false;
    }
    
    // AUDITORÍA
    match /auditLogs/{logId} {
      allow read, write: if true;
    }
  }
}
